# Visual Studio 2025 快速开始

## ✅ 项目已升级！

项目已成功升级以支持 Visual Studio 2025：
- ✅ 95 个项目文件已升级到 v144 工具集
- ✅ 解决方案文件已更新
- ✅ Windows SDK 已更新到 Windows 10/11
- ✅ 构建脚本已支持 VS2025

## 安装 Visual Studio 2025

### 步骤 1: 下载并安装

1. **下载 Visual Studio 2025**
   - 访问: https://visualstudio.microsoft.com/downloads/
   - 下载 Visual Studio 2025 Community（免费版）

2. **运行安装程序**
   - 启动 Visual Studio Installer
   - 选择 "安装" 或 "修改"

3. **选择工作负载**
   - ✅ **使用 C++ 的桌面开发** (Desktop development with C++)
   - 在右侧详细信息中确保勾选：
     - ✅ MFC 和 ATL 支持
     - ✅ Windows 10 SDK 或 Windows 11 SDK
     - ✅ MSVC v144 编译器工具集

4. **完成安装**
   - 等待安装完成
   - 重启计算机（如提示）

### 步骤 2: 验证安装

```powershell
cd src\BuildScript
.\detect-vs2025.ps1
```

应该看到：
```
[OK] Found: Visual Studio 2025
```

### 步骤 3: 构建项目

```batch
cd src\BuildScript
build-fixed.cmd
```

## 如果检测不到 VS2025

### 方法 1: 手动设置环境变量

找到 Visual Studio 2025 安装路径（通常在）：
```
C:\Program Files\Microsoft Visual Studio\2025\Community\Common7\Tools\
```

然后设置环境变量：
```batch
set VS180COMNTOOLS=C:\Program Files\Microsoft Visual Studio\2025\Community\Common7\Tools\
```

### 方法 2: 使用完整路径

编辑 `build-fixed.cmd`，在检测部分添加你的 VS2025 路径。

### 方法 3: 在 Visual Studio 中打开

1. 双击 `src\splayer.sln`
2. Visual Studio 2025 会自动打开
3. 如果提示升级，选择 "是"
4. 生成 → 生成解决方案

## 首次构建注意事项

1. **重定向项目**（如提示）:
   - Visual Studio 会提示重定向项目
   - 选择 Windows SDK 版本（10.0 或 11.0）
   - 点击 "确定"

2. **处理编译错误**:
   - VS2025 可能产生新的警告
   - 逐步修复或暂时忽略（如果不影响功能）

3. **更新第三方库**（如需要）:
   - 某些库可能需要重新编译
   - 或使用预编译版本

## 构建输出

构建成功后，可执行文件位于：
```
src\out\bin\Release Unicode\splayer.exe
```

## 常见问题

### Q: 构建时提示 "找不到工具集 v144"

**解决**:
1. 确保 VS2025 完全安装
2. 在 Visual Studio Installer 中检查 "Desktop development with C++"
3. 重启计算机

### Q: 项目无法打开

**解决**:
1. 确保使用 Visual Studio 2025
2. 如果提示升级，选择 "是"
3. 检查项目文件是否损坏（可从 .backup 恢复）

### Q: 编译错误：C++ 标准

**解决**:
1. 项目属性 → C/C++ → 语言
2. C++ 语言标准 → 选择 "ISO C++14" 或 "ISO C++17"

## 回退

如果需要回退到旧版本：

```powershell
# 恢复所有备份文件
Get-ChildItem -Path src -Filter "*.backup" -Recurse | ForEach-Object {
    $original = $_.FullName -replace '\.backup$', ''
    Copy-Item $_.FullName $original -Force
    Write-Host "Restored: $original"
}
```

## 相关文档

- [VS2025 支持指南](docs/VS2025-SUPPORT.md)
- [完整安装指南](完整安装指南.md)
- [构建修复指南](docs/BUILD-FIXES.md)
